<div class="parts-slider-container">
  <div class="parts-slider-header">Import Costing</div>
  <div class="parts-slider-content">
    <div class="row pt-3">
      <div class="col-12">
        <div class="col-6">
          <div class="row">
            <div class="col-6">
              <label class="parts-slider-label-key">Project #</label>
              <label class="parts-slider-label-value">{{ rowData.projectInfoId }}</label>
            </div>
            <div class="col-6">
              <label class="parts-slider-label-key">Project Name</label>
              <label class="parts-slider-label-value">{{ rowData.projectName }}</label>
            </div>
          </div>
        </div>
        <div class="col-6"></div>
      </div>
    </div>
    <div class="row pt-3">
      <label class="parts-copy-info-tag">
        <span class="notification" placement="auto">&#9432;</span>
        Few parts in this project has already been costed before. 'Select parts' to import their costing or 'Start new costing'
      </label>
    </div>
    <div class="row pt-3">
      <p-tabs value="0">
        <p-tablist>
          <p-tab value="0">Previously Costed</p-tab>
          <p-tab value="1">New</p-tab>
        </p-tablist>
        <p-tabpanels>
          <p-tabpanel value="0">
            <p-table
              [value]="groupedData"
              dataKey="intPartNumber"
              class="parts-slider-scrollable-table"
              [tableStyle]="{ 'min-width': '60rem' }"
              expandableRows
              [expandedRowKeys]="expandedRows"
              [scrollable]="true"
              scrollHeight="flex"
              #dt>
              <ng-template pTemplate="header">
                <tr>
                  <th style="width: 3rem" scope="col"></th>
                  <th scope="col">Part</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-partGroup>
                <tr>
                  <td>
                    <a href="#" (click)="dt.toggleRow(partGroup); $event.preventDefault()" [attr.aria-label]="'toggle ' + partGroup.intPartNumber">
                      <i class="pi pi-chevron-right"></i>
                    </a>
                  </td>
                  <td>{{ partGroup.intPartNumber }}</td>
                </tr>
              </ng-template>

              <ng-template pTemplate="expandedrow" let-partGroup>
                <tr>
                  <td colspan="2">
                    <p-table
                      [value]="partGroup.records"
                      selectionMode="single"
                      [selection]="getSelectedChildRow(partGroup.intPartNumber)"
                      (selectionChange)="onChildSelectionChange(partGroup.intPartNumber, $event)"
                      dataKey="partInfoId"
                      class="child-table">
                      <ng-template pTemplate="header">
                        <tr>
                          <th scope="col"></th>
                          <th scope="col">Project #</th>
                          <th scope="col">% Costing Completed</th>
                          <th scope="col">Supplier</th>
                          <th scope="col">Should Cost</th>
                          <th scope="col">Created by</th>
                          <th scope="col">Costed on</th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-detail>
                        <tr [pSelectableRow]="detail">
                          <td>
                            <p-tableRadioButton [value]="detail" name="radio-{{ partGroup.intPartNumber }}"></p-tableRadioButton>
                          </td>
                          <td [matTooltip]="detail.scenarioName" matTooltipPosition="above">{{ detail.projectInfoId }}</td>
                          <td>
                            <span class="col-completion col-completion-grid-align">
                              <app-progress-bar [percentage]="detail.totalPercentage" [mode]="'donut'"></app-progress-bar>
                              <span [innerText]="detail.totalPercentage"></span>
                            </span>
                          </td>
                          <td>{{ detail.supplierName }}</td>
                          <td>{{ detail.shouldCost }}</td>
                          <td>{{ detail.createdUserName }}</td>
                          <td>{{ detail.createDate | date: 'medium' }}</td>
                        </tr>
                      </ng-template>
                    </p-table>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </p-tabpanel>
          <p-tabpanel value="1"></p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>
  </div>
  @if (canUpdate) {
    <div class="parts-slider-footer">
      <div class="row pt-3">
        <div class="col-12">
          <div class="row">
            <div class="col-8"></div>
            <div class="col-4 d-flex align-items-center justify-content-between mb-4">
              <p class="mb-0 px-2 selection-dock-text">{{ getTotalSelectedParts() }} parts selected to import</p>
              <button type="button" class="btn btn-primary d-flex align-items-center justify-content-center" (click)="startCosting()">Start Costing</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>
