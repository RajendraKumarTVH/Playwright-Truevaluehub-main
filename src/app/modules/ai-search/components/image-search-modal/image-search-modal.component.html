<div class="image-search-dialog-container flex flex-col">
  <div class="dialog-header pb-3 m-0 d-flex justify-content-between align-items-center">
    <h2 mat-dialog-title class="text-xs font-semibold text-black p-0">Search By Image</h2>
    <button type="button" class="icon-btn w-6 h-6 flex align-items-center justify-content-center" (click)="onCancel()" title="Close">
      <mat-icon svgIcon="close_icon" class="!size-4 text-black"></mat-icon>
    </button>
  </div>

  <mat-dialog-content class="dialog-content overflow-visible p-0">
    <div class="image-search-dialog-content flex flex-col gap-1">
      <div class="upload-dropzone" [class.has-file]="selectedFile">
        <!-- Show preview if file is selected -->
        <div *ngIf="imagePreview && selectedFile && !isUploading" class="image-preview-container p-2 flex items-center justify-center w-full max-w-full relative">
          <img [src]="imagePreview" alt="Preview" class="image-preview" />
          <button type="button" class="remove-image-btn icon-btn flex justify-center items-center" (click)="removeSelectedFile()" title="Remove image">
            <mat-icon svgIcon="delete_icon"></mat-icon>
          </button>
        </div>

        <!-- Show placeholder if no file -->
        <div *ngIf="!selectedFile" class="upload-placeholder bg-white">
          <div class="p-3 w-full flex flex-col items-center justify-center">
            <div class="upload-icon-placeholder !mb-4">
              <img src="assets/images/create-project-placeholder.png" alt="Drag and drop files" class="w-32 h-auto" />
            </div>
            <p class="upload-text text-xs text-black m-0">Drag and drop files here or</p>
            <input #fileInput id="fileInput" type="file" accept="image/jpeg,image/jpg,image/png" (change)="onFileSelected($event)" hidden />
            <label for="fileInput" class="choose-files-link inline-flex items-center text-xs gap-2 cursor-pointer">
              <span><mat-icon class="!size-4 d-flex align-items-center justify-content-center flex-shrink-0 !mr-1" svgIcon="upload_icon"></mat-icon></span>
              <span>Choose files</span>
              <p class="upload-hint m-0 text-black text-xs">to Upload a Photo of the Part you are looking for</p>
            </label>
            <p class="supported-formats mx-0 text-xs !mt-4 mb-0">Supported File Formats: .jpg, .png</p>
          </div>

          <div *ngIf="hasUploadError" class="error flex justify-center items-center w-full !p-2 mt-2">
            <mat-icon svgIcon="information" class="w-2 h-2 mr-1"></mat-icon>
            <p class="m-0 text-xs leading-normal">The uploaded file is not compatible.</p>
          </div>
        </div>
        <!-- Show drag-over state -->
        <!-- Uncomment below to see drag-over state -->
        <!-- <div *ngIf="isDragOver && !selectedFile && !isUploading" class="drag-over-state flex flex-col items-center justify-center w-full p-3">
          <p class="text-black text-sm font-medium m-0">Drop file here</p>
        </div> -->
      </div>

      <!-- File Info (shown when file is selected) -->
      <div *ngIf="selectedFile && !isUploading" class="file-info">
        <div class="file-name text-xs font-semibold overflow-hidden text-ellipsis whitespace-nowrap text-black">{{ selectedFile?.name }}</div>
        <div class="file-size text-xs !mt-1">{{ selectedFile?.size ? (selectedFile.size / 1024).toFixed(0) + ' KB' : '' }}</div>
      </div>

      <!-- Upload Progress (shown during upload) -->
      <div *ngIf="isUploading" class="upload-progress flex flex-col items-center justify-center w-full">
        <p-progress-spinner strokeWidth="8" fill="transparent" animationDuration="1.5s" class="spinner-icon" />
        <p class="upload-status-text mb-0 !mt-3 text-black text-xs">Uploading image</p>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions !min-h-8 !mt-5 py-2 px-3 flex justify-end !gap-3 m-0">
    <button type="button" class="btn btn-outline-primary min-w-24" (click)="onCancel()" title="Cancel">Cancel</button>
    <button type="button" class="btn btn-primary min-w-24" [disabled]="!selectedFile || isUploading || hasUploadError" (click)="onSearchClicked()" title="Search">Search</button>
  </mat-dialog-actions>
</div>
