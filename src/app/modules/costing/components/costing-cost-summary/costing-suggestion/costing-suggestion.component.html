<div>
  <div class="suggestion-container">
    <div class="row suggestion-details">
      <div class="suggestion-header">Based on a comprehensive analysis of multiple parts and projects, the following materials are recommended:</div>
      <div class="col-lg-12 suggestion-data">
        <div class="pdf-suggestion-section">
          <div class="costing-note-container">
            <label for="control-input" class="mt-2 lblcostsummarynotes mb-3 suggestion-header-border">> Customer Spec:</label>
            <div #notesEditor name="control-label" contenteditable="false" class="notes-editor form-control" rows="25">
              {{ costingNotesText?.innerHTML }}
            </div>
          </div>
        </div>
        <div class="image-suggestion-section">
          <label for="control-input" class="mt-2 lblcostsummarynotes mb-3 suggestion-header-border">> Based on costing history:</label>
          <div *ngIf="materialInfoDataSource?.length > 0" class="image-container">
            <div class="card">
              <div class="col-lg-12">
                <div class="table-container">
                  <table mat-table [dataSource]="manufactutingCategoryDto" class="mat-elevation-z8" aria-describedby="Material">
                    <ng-container matColumnDef="category">
                      <th mat-header-cell *matHeaderCellDef>Suggested Manufacturing Category:</th>
                      <td mat-cell *matCellDef="let row">{{ row.category }}</td>
                    </ng-container>

                    <ng-container matColumnDef="accuracy">
                      <th mat-header-cell *matHeaderCellDef>Accuracy:</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.averageScore ? row.averageScore + ' %' : '-' }}
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsCategory"></tr>
                    <tbody>
                      <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsCategory" [ngClass]="{ 'highlight-row': i === 0 }"></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="col-lg-12">
                <div class="table-container">
                  <table mat-table [dataSource]="processGroupDto" class="mat-elevation-z8" aria-describedby="Material">
                    <ng-container matColumnDef="processGroup">
                      <th mat-header-cell *matHeaderCellDef>Suggested Process Group:</th>
                      <td mat-cell *matCellDef="let row">{{ row.processGroup }}</td>
                    </ng-container>

                    <ng-container matColumnDef="accuracy">
                      <th mat-header-cell *matHeaderCellDef>Accuracy:</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.accuracy ? row.accuracy + ' %' : '-' }}
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsProcess"></tr>
                    <tbody>
                      <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsProcess" [ngClass]="{ 'highlight-row': i === 0 }"></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="col-lg-12">
                <div class="table-container">
                  <table mat-table [dataSource]="materialInfoDataSource" class="mat-elevation-z8" aria-describedby="Material">
                    <ng-container matColumnDef="processName">
                      <th mat-header-cell *matHeaderCellDef>Process Group</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.processName ? row.processName : '-' }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="materialDescription">
                      <th mat-header-cell *matHeaderCellDef>Suggested Material Description:</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.materialDescription ? row.materialDescription : '-' }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="similarityScore">
                      <th mat-header-cell *matHeaderCellDef>Accuracy:</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.similarityScore ? row.similarityScore + ' %' : '-' }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="avgScore">
                      <th mat-header-cell *matHeaderCellDef>Avg Accuracy:</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.avgScore ? row.avgScore + ' %' : '-' }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="projectInfoIds">
                      <th mat-header-cell *matHeaderCellDef>Based on previous costed projects(no's):</th>
                      <td mat-cell *matCellDef="let row">
                        <div class="project-info-column">
                          <span style="display: flex" *ngFor="let projectId of row.projectInfoIds; let last = last">
                            <span>{{ projectId ? projectId : '-' }}</span>
                            <span>
                              <button type="button" (click)="goToCosting(projectId)" class="costing-button" title="Go to Costing page">
                                <i class="pi pi-arrow-up-right" style="color: slateblue; margin-left: 25%"></i>
                              </button>
                            </span>
                            <span *ngIf="!last">,</span>
                          </span>
                        </div>
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tbody>
                      <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumns" [ngClass]="{ 'highlight-row': i === 0 }"></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div *ngIf="processInfoDataSource?.length > 0" class="card">
              <div class="col-lg-12">
                <div class="table-container">
                  <table mat-table [dataSource]="processInfoDataSource" class="mat-elevation-z8" aria-describedby="Manufacturing">
                    <ng-container matColumnDef="machineDescription">
                      <th mat-header-cell *matHeaderCellDef>Suggested Machine Description</th>
                      <td mat-cell *matCellDef="let row">{{ row.processTypeID === processTypeId.Others ? row.processDetails : row.machineDescription }}</td>
                    </ng-container>

                    <ng-container matColumnDef="similarityScore">
                      <th mat-header-cell *matHeaderCellDef>Similarity Score</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.similarityScore ? row.similarityScore : '-' }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="avgScore">
                      <th mat-header-cell *matHeaderCellDef>Avg Score</th>
                      <td mat-cell *matCellDef="let row">
                        {{ row.avgScore ? row.avgScore : '-' }}
                      </td>
                    </ng-container>

                    <ng-container matColumnDef="projectInfoIds">
                      <th mat-header-cell *matHeaderCellDef>Based on previous costed projects(no's):</th>
                      <td mat-cell *matCellDef="let row">
                        <div class="project-info-column">
                          <span style="display: flex" *ngFor="let projectId of row.projectInfoIds; let last = last">
                            <span>{{ projectId ? projectId : '-' }}</span>
                            <span>
                              <button type="button" (click)="goToCosting(projectId)" class="costing-button" title="Go to Costing page">
                                <i class="pi pi-arrow-up-right" style="color: slateblue; margin-left: 25%"></i>
                              </button>
                            </span>
                            <span *ngIf="!last">,</span>
                          </span>
                        </div>
                      </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumnsManufacturing"></tr>
                    <tbody>
                      <tr mat-row *matRowDef="let row; let i = index; columns: displayedColumnsManufacturing" [ngClass]="{ 'highlight-row': i === 0 }"></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="no-suggestion-text" *ngIf="materialInfoDataSource?.length === 0">
            <span>No suggestions found...</span>
          </div>
        </div>
        <div style="width: 40%" class="ai-suggestion-section">
          <label for="control-input" class="mt-2 lblcostsummarynotes mb-3 suggestion-header-border">> AI Suggestion:</label>
          <div *ngIf="aiSuggestionFinal?.length > 0" class="image-container">
            <div class="suggestion-left-header" *ngIf="manufacturingCategoryFromPdf || manufactutingCategoryDto">
              Manufacturing Category:
              <span style="font-weight: 600">{{ manufacturingCategoryFromPdf ?? manufactutingCategoryDto[0]?.category }}</span>
            </div>
            <div class="suggestion-left-header" *ngIf="aiSuggestionFinal.length > 0">
              Process Group:
              <span style="font-weight: 600">{{ processMasterDict[aiSuggestionFinal[0].processId]?.primaryProcess }}</span>
            </div>
            <div *ngIf="aiSuggestionFinal?.length > 0 && aiSuggestionFinal[0]?.materialInfoDtos?.length > 0">
              Material Description:
              <span style="font-weight: 600">{{ aiSuggestionFinal[0]?.materialInfoDtos[0].materialDescription }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
